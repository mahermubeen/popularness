<template>
  <section class="body-container welcome-wrapper">
    <Sidebar></Sidebar>
    <main class="videos-box">
      <div class="banner-wrapper">
        <div class="left-video-box">
          <div class="video-wrapper1">
            <div
              class="wistia_responsive_padding"
              style="padding:56.25% 0 0 0;position:relative;"
            >
              <div
                class="wistia_responsive_wrapper"
                style="height:100%;left:0;position:absolute;top:0;width:100%;"
              >
                <div
                  :class="
                    `wistia-player-container wistia_embed wistia_async_c98ysw0eye seo=false videoFoam=true
                    controlsVisibleOnLoad=false playButton=false playbar=true smallPlayButton=true qualityControl=false playbackRateControl=false`
                  "
                  style="height:100%;width:100%"
                >
                  &nbsp;
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="right-videos-box">
          <div class="video-wrapper2">
            <!-- <img src="../../assets/images/Group 271.png" alt="Popularness" /> -->
            <div
              class="wistia_responsive_padding"
              style="padding:56.25% 0 0 0;position:relative;"
            >
              <div
                class="wistia_responsive_wrapper"
                style="height:100%;left:0;position:absolute;top:0;width:100%;"
              >
                <div
                  :class="
                    `wistia-player-container wistia_embed wistia_async_pmcpau8wmj seo=false videoFoam=true 
                    controlsVisibleOnLoad=false playButton=false playbar=false smallPlayButton=false qualityControl=false playbackRateControl=false`
                  "
                  style="height:100%;width:100%"
                >
                  &nbsp;
                </div>
              </div>
            </div>
          </div>

          <div class="video-wrapper3">
            <!-- <img src="../../assets/images/Group 270.png" alt="Popularness" /> -->
            <div
              class="wistia_responsive_padding"
              style="padding:56.25% 0 0 0;position:relative;"
            >
              <div
                class="wistia_responsive_wrapper"
                style="height:100%;left:0;position:absolute;top:0;width:100%;"
              >
                <div
                  :class="
                    `wistia-player-container wistia_embed wistia_async_8nx0eir0wv seo=false videoFoam=true stillUrl=//embed-ssl.wistia.com/deliveries/597e82156c991873e9f7defcf1caf171.jpg?video_still_time=0 controlsVisibleOnLoad=false playButton=false playbar=false smallPlayButton=false qualityControl=false playbackRateControl=false`
                  "
                  style="height:100%;width:100%"
                >
                  &nbsp;
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="centre-menu-wrapper">
        <div class="options">
          <button class="date-btn">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="19"
              viewBox="0 0 18 19"
            >
              <path
                d="M2.47847 18.6923H15.5215C16.8888 18.6923 18 17.5811 18 16.2138V3.86306C18 2.49575 16.8888 1.38459 15.5215 1.38459H14.5385V0.692294C14.5385 0.311521 14.2269 0 13.8461 0C13.4653 0 13.1538 0.311521 13.1538 0.692294V1.38459H4.84618V0.692294C4.84618 0.311521 4.5346 0 4.15382 0C3.77305 0 3.46153 0.311521 3.46153 0.692294V1.38459H2.47847C1.11116 1.38459 0 2.49575 0 3.86306V16.2138C0 17.5811 1.11116 18.6923 2.47847 18.6923ZM1.38465 3.86306C1.38465 3.26077 1.87618 2.76924 2.47847 2.76924H3.46153V3.46153C3.46153 3.8423 3.77305 4.15382 4.15382 4.15382C4.5346 4.15382 4.84612 3.8423 4.84612 3.46153V2.76924H13.1538V3.46153C13.1538 3.8423 13.4653 4.15382 13.8461 4.15382C14.2269 4.15382 14.5384 3.8423 14.5384 3.46153V2.76924H15.5215C16.1238 2.76924 16.6153 3.26077 16.6153 3.86306V16.2138C16.6153 16.8161 16.1238 17.3076 15.5215 17.3076H2.47847C1.87618 17.3076 1.38465 16.8161 1.38465 16.2138V3.86306Z"
                fill="white"
              />
              <path
                d="M5.0193 7.96154C5.49723 7.96154 5.88467 7.5741 5.88467 7.09617C5.88467 6.61824 5.49723 6.2308 5.0193 6.2308C4.54137 6.2308 4.15393 6.61824 4.15393 7.09617C4.15393 7.5741 4.54137 7.96154 5.0193 7.96154Z"
                fill="white"
              />
              <path
                d="M8.82692 7.96154C9.30485 7.96154 9.69228 7.5741 9.69228 7.09617C9.69228 6.61824 9.30485 6.2308 8.82692 6.2308C8.34899 6.2308 7.96155 6.61824 7.96155 7.09617C7.96155 7.5741 8.34899 7.96154 8.82692 7.96154Z"
                fill="white"
              />
              <path
                d="M12.6347 7.96154C13.1126 7.96154 13.5 7.5741 13.5 7.09617C13.5 6.61824 13.1126 6.2308 12.6347 6.2308C12.1567 6.2308 11.7693 6.61824 11.7693 7.09617C11.7693 7.5741 12.1567 7.96154 12.6347 7.96154Z"
                fill="white"
              />
              <path
                d="M5.0193 11.4231C5.49723 11.4231 5.88467 11.0356 5.88467 10.5577C5.88467 10.0798 5.49723 9.69232 5.0193 9.69232C4.54137 9.69232 4.15393 10.0798 4.15393 10.5577C4.15393 11.0356 4.54137 11.4231 5.0193 11.4231Z"
                fill="white"
              />
              <path
                d="M8.82692 11.4231C9.30485 11.4231 9.69228 11.0356 9.69228 10.5577C9.69228 10.0798 9.30485 9.69232 8.82692 9.69232C8.34899 9.69232 7.96155 10.0798 7.96155 10.5577C7.96155 11.0356 8.34899 11.4231 8.82692 11.4231Z"
                fill="white"
              />
              <path
                d="M12.6347 11.4231C13.1126 11.4231 13.5 11.0356 13.5 10.5577C13.5 10.0798 13.1126 9.69232 12.6347 9.69232C12.1567 9.69232 11.7693 10.0798 11.7693 10.5577C11.7693 11.0356 12.1567 11.4231 12.6347 11.4231Z"
                fill="white"
              />
              <path
                d="M5.0193 14.8846C5.49723 14.8846 5.88467 14.4971 5.88467 14.0192C5.88467 13.5413 5.49723 13.1538 5.0193 13.1538C4.54137 13.1538 4.15393 13.5413 4.15393 14.0192C4.15393 14.4971 4.54137 14.8846 5.0193 14.8846Z"
                fill="white"
              />
              <path
                d="M8.82692 14.8846C9.30485 14.8846 9.69228 14.4971 9.69228 14.0192C9.69228 13.5413 9.30485 13.1538 8.82692 13.1538C8.34899 13.1538 7.96155 13.5413 7.96155 14.0192C7.96155 14.4971 8.34899 14.8846 8.82692 14.8846Z"
                fill="white"
              />
              <path
                d="M12.6347 14.8846C13.1126 14.8846 13.5 14.4971 13.5 14.0192C13.5 13.5413 13.1126 13.1538 12.6347 13.1538C12.1567 13.1538 11.7693 13.5413 11.7693 14.0192C11.7693 14.4971 12.1567 14.8846 12.6347 14.8846Z"
                fill="white"
              />
            </svg>
            <span>Date</span>
          </button>
          <button class="genre-btn">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="17"
              viewBox="0 0 18 17"
              fill="none"
            >
              <path
                d="M17.4 16.8H0.6C0.44087 16.8 0.288258 16.7368 0.175736 16.6243C0.0632141 16.5117 0 16.3591 0 16.2V0.6C0 0.44087 0.0632141 0.288258 0.175736 0.175736C0.288258 0.0632141 0.44087 0 0.6 0H17.4C17.5591 0 17.7117 0.0632141 17.8243 0.175736C17.9368 0.288258 18 0.44087 18 0.6V16.2C18 16.3591 17.9368 16.5117 17.8243 16.6243C17.7117 16.7368 17.5591 16.8 17.4 16.8ZM1.2 15.6H16.8V1.2H1.2V15.6Z"
                fill="white"
              />
              <path
                d="M6.6 12.6C6.49693 12.5997 6.39567 12.5728 6.306 12.522C6.21332 12.4699 6.13615 12.3941 6.08238 12.3024C6.02861 12.2107 6.00018 12.1063 6 12V4.8C6.00002 4.6941 6.02807 4.59009 6.0813 4.49853C6.13452 4.40698 6.21104 4.33114 6.30306 4.27873C6.39508 4.22632 6.49934 4.1992 6.60524 4.20013C6.71114 4.20105 6.81491 4.22999 6.906 4.284L12.906 7.884C12.9955 7.93713 13.0697 8.01263 13.1212 8.1031C13.1727 8.19357 13.1998 8.29589 13.1998 8.4C13.1998 8.50411 13.1727 8.60643 13.1212 8.6969C13.0697 8.78736 12.9955 8.86287 12.906 8.916L6.906 12.516C6.81339 12.571 6.70769 12.6 6.6 12.6ZM7.2 5.862V10.938L11.436 8.4L7.2 5.862Z"
                fill="white"
              />
            </svg>
            <span>Genre</span>
          </button>
          <button class="artist-btn">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="18"
              viewBox="0 0 12 18"
              fill="none"
            >
              <path
                d="M11.3841 9.18677C11.3841 8.83102 11.112 8.55897 10.7563 8.55897C10.4005 8.55897 10.1285 8.83102 10.1285 9.18677C10.1285 11.6352 8.14044 13.6232 5.69203 13.6232C3.24362 13.6232 1.25559 11.6352 1.25559 9.18677C1.25559 8.83102 0.983549 8.55897 0.627797 8.55897C0.272046 8.55897 0 8.83102 0 9.18677C0 12.0956 2.17636 14.544 5.06423 14.8579V16.532H2.78324C2.42748 16.532 2.15544 16.804 2.15544 17.1598C2.15544 17.5155 2.42748 17.7876 2.78324 17.7876H8.60083C8.95658 17.7876 9.22862 17.5155 9.22862 17.1598C9.22862 16.804 8.95658 16.532 8.60083 16.532H6.31983V14.8579C9.2077 14.544 11.3841 12.0956 11.3841 9.18677Z"
                fill="white"
              />
              <path
                d="M5.69201 0C3.76676 0 2.19727 1.56949 2.19727 3.49474V9.16584C2.19727 11.112 3.76676 12.6606 5.69201 12.6815C7.61725 12.6815 9.18675 11.112 9.18675 9.18677V3.49474C9.18675 1.56949 7.61725 0 5.69201 0Z"
                fill="white"
              />
            </svg>
            <span>Artists</span>
          </button>
        </div>
        <div class="main-content">
          <!-- <div class="calendar date-menu hidden">
            <v-date-picker v-model="selectedDate" is-dark :attributes="attrs" />
          </div> -->

          <div class="genre-menu hidden">
            <div class="genre-list">
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Alternative/Rock</span>
              </div>
              <div class="item active">
                <img src="../../assets/images/whtie-box.png" />
                <span>Classical</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Country</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Dance/Electronic</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Gospel/Spirtual</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Hip-Hop/Rap</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Jazz/Blues</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Latin</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Pop</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>R&B/Soul</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Reggae/Caribbean</span>
              </div>
              <div class="item">
                <img src="../../assets/images/whtie-box.png" />
                <span>Wordly/International</span>
              </div>
            </div>
          </div>
          <div class="artist-menu hidden">
            <div class="letter-wrapper">
              <span>A</span>
              <span>B</span>
              <span>C</span>
              <span>D</span>
              <span>E</span>
              <span>F</span>
              <span>G</span>
              <span>H</span>
              <span>J</span>
              <span>H</span>
              <span>I</span>
              <span>J</span>
              <span>K</span>
              <span>L</span>
              <span class="active">M</span>
              <span>N</span>
              <span>O</span>
              <span>P</span>
              <span>Q</span>
              <span>R</span>
              <span>S</span>
              <span>T</span>
              <span>U</span>
              <span>V</span>
              <span>W</span>
              <span>X</span>
              <span>Y</span>
              <span>Z</span>
            </div>
          </div>
        </div>
      </div>

      <section
        class="video-list"
        v-for="(videosByDate, date) in allVideos"
        :key="date"
      >
        <h2>{{ getFormattedDate(date) }}</h2>

        <div class="videos-wrapper">
          <div class="row1">
            <div
              class="video-content"
              v-for="(video, index) in videosByDate"
              :key="index"
            >
              <div class="main-video">
                <router-link :to="`/video-play/${video.hash_id}`">
                  <img
                    :src="
                      video.image
                        ? video.image
                        : './../../assets/images/banner-img.jpg'
                    "
                  />
                </router-link>
              </div>

              <div class="video-detail">
                <router-link :to="`/video-play/${video.hash_id}`">
                  <h3>{{ video.title }}</h3>
                </router-link>
                <div class="artist-info">
                  <router-link :to="`/artist-profile/${video.user.handle}`">
                    <span class="name">{{ video.artistname }}</span>
                  </router-link>
                  <span class="genre">{{ video.genre.genre }}</span>
                </div>
                <span class="views">{{ video.views }} Views</span>
              </div>
            </div>
          </div>
        </div>
      </section>
      <div class="load-btn" v-if="allVideos.length > visibleVideosCount">
        <button @click="visibleVideosCount += 3">Load More</button>
      </div>
    </main>
  </section>
</template>

<script>
import { mapState, mapGetters } from "vuex";
import moment from "moment";
import Sidebar from "./../layouts/components/Sidebar";
import Calendar from "v-calendar/lib/components/calendar.umd";
import DatePicker from "v-calendar/lib/components/date-picker.umd";

export default {
  components: {
    Sidebar
  },
  data() {
    return {
      visibleVideosCount: 9,
      playlistInfo: [],
      newUserPlaylist: null,
      playlistChecked: [],
      userPlaylists: [],
      attrs: [
        {
          key: "today",
          highlight: true,
          highlight: "#ffa472",
          highlight: {
            color: "#ffa472",
            fillMode: "outline",
            class: "highlight-date"
          },
          dates: new Date()
        }
      ],
      filters: {
        genreChecked: [],
        dateRange: {},
        artistInitial: null
      },
      components: {
        Calendar,
        DatePicker
      }
    };
  },
  mounted() {
    this.$store.dispatch("getLatestVideos");
  },
  computed: {
    ...mapState({
      user: state => state.user,
      allVideos: state => state.video.latestVideos,
      latestVideos() {
        let sliced = []
        this.allVideos.reduce((count, current) => {
          if((count + current.length <= this.visibleVideosCount)) {
            sliced.push(current)
          } else {
            sliced.push(current.slice(0, count + current.length - this.visibleVideosCount))
          }
          }, 0);
          return sliced
        // let groupedByDate = {};
        // this.allVideos.slice(0, this.visibleVideosCount).forEach(video => {
        //   const publishDate = new Date(video.publish_date).toDateString();
        //   // const publishDate = moment(video.publish_date, 'M/D/YYYY').toLocaleString();
        //   // console.log(video.publish_date);
        //   // console.log();
        //   // const publishDate = new Date(Date.parse("2005-07-08T00:00:00Z")).toString();
        //   // const publishDate = Date.parse(moment(video.publish_date));
        //   if (groupedByDate[publishDate]) {
        //     groupedByDate[publishDate].push(video);
        //   } else {
        //     groupedByDate[publishDate] = [video];
        //   }
        // });

        // return Object.keys(groupedByDate)
        //   .sort((a, b) => new Date(b) - new Date(a))
        //   .reduce((obj, key) => {
        //     obj[key] = groupedByDate[key];
        //     return obj;
        //   }, {});
      }
    }),
    ...mapGetters(["isLogged"])
  },
  methods: {
    showModal(video) {
      if (this.isLogged) {
        this.videoDetails = video;
        this.getMyPlaylists();
        this.getPlaylistAssociations(video.hash_id);
        this.$modal.show("addToPlaylistModal");
      } else {
        this.$notify({
          title: "Error!",
          text: "Please log in first!",
          type: "error"
        });
        this.$router.push({ name: "login" });
      }
    },
    getMyPlaylists() {
      this.$store
        .dispatch("getMyPlaylists")
        .then(response => {
          if (!response.status) {
            this.$notify({
              title: "Error!",
              text: "Playlist Information Not Found",
              type: "error"
            });
          }
          this.userPlaylists = response.data;
        })
        .catch(err => {
          this.$notify({
            title: "Error!",
            text: err.message,
            type: "error"
          });
        });
    },
    getPlaylistAssociations(hashId) {
      this.$store
        .dispatch("getPlaylistAssociations", { hashId: hashId })
        .then(response => {
          this.playlistChecked = Object.keys(response.data.data);
        })
        .catch(err => {
          this.$notify({
            title: "Error!",
            text: err.message,
            type: "error"
          });
        });
    },
    savePlaylistInfo() {
      this.$store
        .dispatch("savePlaylist", {
          playlistIds: this.playlistChecked,
          newPlaylist: this.newUserPlaylist,
          videoId: this.videoDetails.id
        })
        .then(response => {
          if (response.data.status) {
            this.$notify({
              title: "Success!",
              text: response.data.message,
              type: "success"
            });
            this.$store.dispatch("getMyPlaylists");
            this.$modal.hide("addToPlaylistModal");
          }
        })
        .catch(err => {
          this.$notify({
            title: "Error!",
            text: err.message,
            type: "error"
          });
        });
    },
    goToArtistProfile(artist) {
      if (artist && artist.handle) {
        this.$router.push("/artist-profile/" + artist.handle);
      } else {
        this.$router.push("/artist-profile/" + artist.handle);
      }
    },
    getFormattedDate(date) {
      // console.log(new Date(Date.parse(date)).toString());
      // console.log(moment(date).format('YYYY/DD/MM'));
      // return moment(date)
      // return moment(date).format("DD/MM/YYYY");
      return moment(new Date(date)).format("MMMM D, Y");
    }
  }
};
</script>

<style scoped>
.playlist-item {
  display: inline-block;
  width: auto;
  height: auto;
}
.playlist-item-span {
  /* font-family: "futura-light"; */
  color: #fff;
  display: inline-block;
  align-items: center;
  justify-content: space-between;
  background: none;
  padding-left: 10px;
  font-weight: 600;
  font-size: 14px;
  position: relative;
}
.playlist-item-span:hover {
  color: #ffa472;
}

/* v-calendar styles */
.vc-container.vc-is-dark {
  color: var(--gray-100);
  background-color: #000;
  border: none;
  width: 100%;
}
</style>
